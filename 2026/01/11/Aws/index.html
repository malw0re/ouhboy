<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>AWS Security | ouhboy</title><meta name="author" content="malw0re"><meta name="copyright" content="malw0re"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="AWS Security Before we do anything else, letâ€™s start at the absolute beginning with Identity. AWS Identity BasicsAccount â€“ Your Primary Security BoundaryAnÂ AWS accountÂ is an isolated container for res">
<meta property="og:type" content="article">
<meta property="og:title" content="AWS Security">
<meta property="og:url" content="https://malw0re.github.io/ouhboy/2026/01/11/Aws/index.html">
<meta property="og:site_name" content="ouhboy">
<meta property="og:description" content="AWS Security Before we do anything else, letâ€™s start at the absolute beginning with Identity. AWS Identity BasicsAccount â€“ Your Primary Security BoundaryAnÂ AWS accountÂ is an isolated container for res">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://malw0re.github.io/ouhboy/images/aws.png">
<meta property="article:published_time" content="2026-01-11T09:44:04.000Z">
<meta property="article:modified_time" content="2026-02-01T00:16:37.097Z">
<meta property="article:author" content="malw0re">
<meta property="article:tag" content="AWS">
<meta property="article:tag" content="Cloud">
<meta property="article:tag" content="CloudSecurity">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://malw0re.github.io/ouhboy/images/aws.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "AWS Security",
  "url": "https://malw0re.github.io/ouhboy/2026/01/11/Aws/",
  "image": "https://malw0re.github.io/ouhboy/images/aws.png",
  "datePublished": "2026-01-11T09:44:04.000Z",
  "dateModified": "2026-02-01T00:16:37.097Z",
  "author": [
    {
      "@type": "Person",
      "name": "malw0re",
      "url": "https://malw0re.github.io/ouhboy"
    }
  ]
}</script><link rel="shortcut icon" href="/ouhboy/img/favicon.png"><link rel="canonical" href="https://malw0re.github.io/ouhboy/2026/01/11/Aws/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="rlAytyL_0DZIdaeKciunM68sC0ovsRtNWdw3kMCtTFE"/><link rel="stylesheet" href="/ouhboy/css/index.css?v=5.5.3"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/ouhboy/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"You have switched to Traditional Chinese","cht_to_chs":"You have switched to Simplified Chinese","day_to_night":"You have switched to Dark Mode","night_to_day":"You have switched to Light Mode","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: true,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'AWS Security',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 8.1.1"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      if ($loadingBox.classList.contains('loaded')) return
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()

  if (document.readyState === 'complete') {
    preloader.endLoading()
  } else {
    window.addEventListener('load', preloader.endLoading)
    document.addEventListener('DOMContentLoaded', preloader.endLoading)
    // Add timeout protection: force end after 7 seconds
    setTimeout(preloader.endLoading, 7000)
  }

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/ouhboy/images/cyber.png" onerror="this.onerror=null;this.src='/ouhboy/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/ouhboy/archives/"><div class="headline">Articles</div><div class="length-num">10</div></a><a href="/ouhboy/tags/"><div class="headline">Tags</div><div class="length-num">14</div></a><a href="/ouhboy/categories/"><div class="headline">Categories</div><div class="length-num">3</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/ouhboy/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/ouhboy/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/ouhboy/categories/writeups/"><i class="fa-fw fas fa-archive"></i><span> Writeups</span></a></div><div class="menus_item"><a class="site-page" href="/ouhboy/categories/research/"><i class="fa-fw fas fa-flask"></i><span> Research</span></a></div><div class="menus_item"><a class="site-page" href="/ouhboy/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url(/ouhboy/images/cyberpunk-red.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/ouhboy/"><span class="site-name">ouhboy</span></a><a class="nav-page-title" href="/ouhboy/"><span class="site-name">AWS Security</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/ouhboy/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/ouhboy/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/ouhboy/categories/writeups/"><i class="fa-fw fas fa-archive"></i><span> Writeups</span></a></div><div class="menus_item"><a class="site-page" href="/ouhboy/categories/research/"><i class="fa-fw fas fa-flask"></i><span> Research</span></a></div><div class="menus_item"><a class="site-page" href="/ouhboy/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">AWS Security</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2026-01-11T09:44:04.000Z" title="Created 2026-01-11 12:44:04">2026-01-11</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2026-02-01T00:16:37.097Z" title="Updated 2026-02-01 03:16:37">2026-02-01</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/ouhboy/categories/research/">research</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="AWS-Security"><a href="#AWS-Security" class="headerlink" title="AWS Security"></a>AWS Security</h1><p><a target="_blank" rel="noopener" href="https://images.coursestack.com/e0cb94d8-532a-4658-bfdd-5400224f2414/62006482-80a6-4d8b-bcbd-26370aa870c4"></a></p>
<p>Before we do anything else, letâ€™s start at the absolute beginning with Identity.</p>
<h2 id="AWS-Identity-Basics"><a href="#AWS-Identity-Basics" class="headerlink" title="AWS Identity Basics"></a><strong>AWS Identity Basics</strong></h2><h3 id="Account-â€“-Your-Primary-Security-Boundary"><a href="#Account-â€“-Your-Primary-Security-Boundary" class="headerlink" title="Account â€“ Your Primary Security Boundary"></a><strong>Account â€“ Your Primary Security Boundary</strong></h3><p>AnÂ <strong>AWS account</strong>Â is an isolated container for resources, billing, and identity roots. Nothing inside one account is reachable from another, unless you create an explicit bridge (VPC peering, crossâ€‘account role, etc.).</p>
<p>An account is where you will be able to run infrastructure like EC2s, Lambdas, Containers DBs, etc. Itâ€™s always needed to create at least 1 AWS account in order to spawn infrastructure in AWS.</p>
<p><em>Security best practice:</em>Â Create separate accounts for different environments and purposes. For example, create an account forÂ <em>dev</em>,Â <em>staging</em>,Â <em>prod</em>,Â <em>logging</em>, andÂ <em>security</em>Â to keep the blast radii small.</p>
<h3 id="Organization-â€“-Governance-at-Scale"><a href="#Organization-â€“-Governance-at-Scale" class="headerlink" title="Organization â€“ Governance at Scale"></a><strong>Organization â€“ Governance at Scale</strong></h3><p>AnÂ <strong>AWS Organization</strong>Â groups multiple AWS accounts under the first AWS account you created (usually called aÂ <strong>management account)</strong>. It lets you apply policies as guardrails like Service Control Policies (SCPs), consolidate billing, and centrally enable services like GuardDuty.</p>
<p><em>Security best practice:</em>Â If an attacker owns the management account, they can assumeÂ <strong>OrganizationAccountAccessRole</strong>Â in every child accountâ€”an instant fleet takeover. Therefore, itâ€™s highly recommended to only use the first AWS account a company creates to create other companies and setup policies for the organization. Donâ€™t use it to run infrastructure or store data to reduce risks.</p>
<h3 id="User-â€“-Longâ€‘Lived-Human-Credential"><a href="#User-â€“-Longâ€‘Lived-Human-Credential" class="headerlink" title="User â€“ Longâ€‘Lived Human Credential"></a><strong>User â€“ Longâ€‘Lived Human Credential</strong></h3><p>AnÂ <strong>IAM user</strong>Â represents a person or (rarely) an app that needs permanent credentials. Each user can have a console password and up to two accessâ€‘key pairs. Passwords and accessâ€‘key pairs should be rotated every once in a while.</p>
<p><em>Security best practice:</em>Â Issue as few users as possible (use AWS Identity Center instead of IAM to create users), enforce MFA, tag them for ownership, and donâ€™t allow the generation of accessâ€‘keys to IAM users if possible.</p>
<h3 id="Role-â€“-Temporary-Scoped-Identity"><a href="#Role-â€“-Temporary-Scoped-Identity" class="headerlink" title="Role â€“ Temporary, Scoped Identity"></a><strong>Role â€“ Temporary, Scoped Identity</strong></h3><p>AnÂ <strong>IAM role</strong>Â has no longâ€‘term credentials. Itâ€™s assumed by users, AWS services, or external identities to receive shortâ€‘livedÂ <strong>STS tokens</strong>. Roles are the default way to grant a workload or person justâ€‘inâ€‘time access or to hop between accounts.</p>
<p><em>Crossâ€‘account role example:</em>Â Your CI pipeline in theÂ <em>build</em>Â account assumesÂ <code>arn:aws:iam::&lt;prodâ€‘id&gt;:role/Deploy</code>Â for only the minutes a deployment runs.</p>
<h3 id="Policy-â€“-Permissions-DNA"><a href="#Policy-â€“-Permissions-DNA" class="headerlink" title="Policy â€“ Permissions DNA"></a><strong>Policy â€“ Permissions DNA</strong></h3><p>AÂ <strong>policy</strong>Â is a JSON document thatÂ <em>allows</em>Â orÂ <em>denies</em>Â specific actions on specific resources, optionally under conditions (e.g., IP, MFA).Â <strong>Policies can include wildcards (<code>*</code>) to match multiple actions or resourcesâ€”for instance,Â <code>&quot;s3:Get*&quot;</code>Â covers every readâ€‘style operation on S3 objects.</strong></p>
<p>Policies come in three flavors:</p>
<ol>
<li><strong>AWSâ€‘managed</strong>Â â€“ maintained by AWS (often overly broad, e.g.,Â <code>AdministratorAccess</code>).</li>
<li><strong>Customerâ€‘managed</strong>Â â€“ reusable policies you craft.</li>
<li><strong>Inline</strong>Â â€“ embedded directly in a user, role, or group (cannot be reused in other principals).</li>
</ol>
<p>Least privilege lives or dies hereâ€”review policies regularly and pruneÂ <code>*</code>Â patterns wherever possible.</p>
<p><strong>Tip:</strong>Â Keep the management account forÂ <strong>creation and governance only</strong>; deploy workloads in member accounts.</p>
<hr>
<p><a target="_blank" rel="noopener" href="https://images.coursestack.com/e0cb94d8-532a-4658-bfdd-5400224f2414/c8e4ffc8-8d80-41af-91bb-9eb93b04b561"></a></p>
<h2 id="Overâ€‘Privilege-Cloud-Enemy-1"><a href="#Overâ€‘Privilege-Cloud-Enemy-1" class="headerlink" title="Overâ€‘Privilege: Cloud Enemy #1"></a><strong>Overâ€‘Privilege: Cloud Enemy #1</strong></h2><p>â€œSoâ€‘andâ€‘so justÂ <strong>added</strong>Â <code>AdministratorAccess</code>Â so we could test.â€ That single sentence explains how most cloud breaches begin. IAM isÂ <strong>complex</strong>, deadlines are short, and the impact of overâ€‘granting rights is invisibleâ€”until the day it isnâ€™t. Here are the typical pathways that lead wellâ€‘meaning engineers to overâ€‘privilege others at the outset:</p>
<ul>
<li><strong>Copyâ€‘pasted tutorials</strong>Â â€“ Many AWS â€œgettingâ€‘startedâ€ guides and Stack Overflow answers useÂ Â actions for brevity. Teams adopt these JSON snippets unchanged and move on.</li>
<li><strong>Thirdâ€‘party quickâ€‘starts</strong>Â â€“ SaaS vendors often ship CloudFormation templates that request full admin access so their product â€œjust works.â€ Security reviews are skipped under goâ€‘live pressure.</li>
<li><strong>Role sprawl during incidents</strong>Â â€“ When production is burning, onâ€‘call staff add broad policies to unblock themselves, but the temporary fix rarely gets rolled back.</li>
<li><strong>AWS managed policies</strong>Â â€“ Default AWSâ€‘managed policies such asÂ <code>PowerUserAccess</code>Â orÂ <code>AmazonEC2FullAccess</code>Â pack far more rights than most workloads need. Attaching them may feel â€œsupportedâ€ but silently grants privilege far beyond requirements.</li>
<li><strong>Inherited legacy accounts</strong>Â â€“ New hires receive keys from a previous admin and no one knows which services still rely on which permissions, so the safest (but least secure) bet is to keep everything.</li>
<li><strong>Lack of fineâ€‘grained understanding</strong>Â â€“ IAMâ€™s JSON syntax, condition keys, and serviceâ€‘specific nuances intimidate newcomers. GrantingÂ <code>AdministratorAccess</code>Â feels simpler than composing a leastâ€‘privilege doc.</li>
</ul>
<p>Overâ€‘privilege turns every credential leak or phishing emailÂ <strong>into</strong>Â a fullâ€‘account takeover. Continuous hygiene matters: run tools likeÂ <a target="_blank" rel="noopener" href="https://github.com/carlospolop/aws_iam_review"><strong><code>aws_iam_review</code></strong></a>Â or AWSÂ <strong>Access Analyzer</strong>Â weekly to flag rights that wereÂ <em>never</em>Â used or areÂ <em>dangerous by design</em>. The goal is a living permissions baselineâ€”anything outside it triggers a security review.</p>
<hr>
<p><a target="_blank" rel="noopener" href="https://images.coursestack.com/e0cb94d8-532a-4658-bfdd-5400224f2414/6fa823f8-ab99-4259-b7d6-79e4b7c9794e"></a></p>
<h2 id="Three-Practical-Privilege-Escalation-Paths"><a href="#Three-Practical-Privilege-Escalation-Paths" class="headerlink" title="Three Practical Privilege Escalation Paths"></a><strong>Three Practical Privilege Escalation Paths</strong></h2><h3 id="1-AttachUserPolicy"><a href="#1-AttachUserPolicy" class="headerlink" title="1. AttachUserPolicy"></a><strong>1. AttachUserPolicy</strong></h3><p><strong>Minimal permission:</strong>Â <code>iam:AttachUserPolicy</code></p>
<p><strong>Goal:</strong>Â Grant yourselfÂ <code>AdministratorAccess</code>Â by attaching a managed policy to your own user.</p>
<p><strong>Attack breakdown</strong></p>
<ol>
<li><strong>Discover your user ARN</strong>Â â€“Â <code>aws iam get-user</code>Â confirms the identity you can manipulate.Â <em>You must target the exact principal you control.</em></li>
<li><strong>Refresh credentials</strong>Â â€“ reâ€‘authenticate or generate fresh keys so AWS reâ€‘evaluates your permission set.Â <em>You now wield unrestricted power across the account.</em></li>
</ol>
<p><a target="_blank" rel="noopener" href="https://cloud.hacktricks.wiki/en/pentesting-cloud/aws-security/aws-privilege-escalation/aws-iam-privesc.html">HackTricks Reference</a></p>
<hr>
<h3 id="2-PassRole-RunInstances"><a href="#2-PassRole-RunInstances" class="headerlink" title="2. PassRole + RunInstances"></a><strong>2. PassRole + RunInstances</strong></h3><p><strong>Minimal permissions:</strong>Â <code>iam:PassRole</code>,Â <code>ec2:RunInstances</code>, and some othersâ€¦</p>
<p><strong>Goal:</strong>Â Spawn an EC2 instance that inherits a powerful role and steal its temporary session tokens.</p>
<p><strong>What is EC2?</strong>Â Amazon Elastic Compute Cloudâ€”onâ€‘demand virtual servers you can launch and control like VMs.</p>
<p><strong>Attack breakdown</strong></p>
<ol>
<li><strong>Enumerate passâ€‘able roles</strong>Â â€“Â <code>aws iam list-roles --query &#39;Roles[?AssumeRolePolicyDocument.Statement[?Principal.Service==\</code>ec2.amazonaws.com<code>]]&#39;</code> lists roles whose trust policy allows EC2.Â <em>Only these can be passed during instance launch.</em></li>
<li><strong>Choose a highâ€‘privilege role</strong>Â â€“ pick one bound toÂ <code>AdministratorAccess</code>Â or similar rights.Â <em>The stronger the role, the bigger the blast radius.</em><ol>
<li><strong>Attach the admin policy</strong>Â â€“Â <code>aws iam attach-user-policy --user-name &lt;name&gt; --policy-arn arn:aws:iam::aws:policy/AdministratorAccess</code>Â stores a policy&#x2F;identity link object.Â <em>This adds every admin right in one API call.</em></li>
</ol>
</li>
<li><strong>Launch an EC2 with the role</strong>Â â€“Â <code>aws ec2 run-instances --iam-instance-profile Name=&lt;roleName&gt; ...</code>Â binds the instance profile.Â <em>The Instance Metadata Service (IMDS) will serve STS creds for that role to the VM.</em></li>
<li><strong>Harvest credentials</strong>Â â€“ inside the VM, runÂ <code>curl http://169.254.169.254/latest/meta-data/iam/security-credentials/&lt;roleName&gt;</code>Â to obtain JSON creds.Â <em>Use them from your workstation; theyâ€™re equivalent toÂ <strong><code>sts:AssumeRole</code></strong>Â without MFA.</em></li>
</ol>
<p>This is a very common privilege escalation attack pattern in cloud environment where an attacker uses a cloud service that can run some code defined by the attack and attaches to the service a role with more privileges so the executed token steals the token of the role, effectively escalating privileges to the role.</p>
<p><a target="_blank" rel="noopener" href="https://cloud.hacktricks.wiki/en/pentesting-cloud/aws-security/aws-privilege-escalation/aws-ec2-privesc.html">HackTricks Reference</a></p>
<hr>
<h3 id="3-PutKeyPolicy-Overreach-KMS"><a href="#3-PutKeyPolicy-Overreach-KMS" class="headerlink" title="3. PutKeyPolicy Overreach (KMS)"></a><strong>3. PutKeyPolicy Overreach (KMS)</strong></h3><p><strong>Resource policies:</strong>Â KMS keysâ€”and several other AWS services like S3, SQS, SNS, Lambda and Secrets Managerâ€”supportÂ <strong>resourceâ€‘based policies</strong>. These JSON documents liveÂ <em>on the resource itself</em>, not on IAM identities, and they are evaluated in addition to IAM permissions. If you can modify a resource policy you can sidestep IAM entirely, granting new principals (or wildcards) access that IAM would otherwise forbid.</p>
<p><strong>Minimal permissions:</strong>Â <code>kms:ListKeys</code>,Â <code>kms:PutKeyPolicy</code>Â *(plusÂ <strong><code>kms:ListKeyPolicies</code></strong>,Â <strong><code>kms:GetKeyPolicy</code></strong>Â for reconnaissance)*</p>
<p><strong>Goal:</strong>Â Rewrite a KMS keyâ€™s policy so youâ€”orÂ <strong>everyone</strong>â€”get fullÂ <code>kms:*</code>Â control, letting you decrypt data, create rogue grants, or lock out legitimate owners.</p>
<p><strong>Attack breakdown</strong></p>
<ol>
<li><strong>Enumerate keys</strong>Â â€“Â <code>aws kms list-keys --query &#39;Keys[*].KeyId&#39;</code>Â reveals every Customer Master Key (CMK) ID.Â <em>Chooses the asset to hijack.</em></li>
<li><strong>Back up current policy</strong>Â â€“Â <code>aws kms get-key-policy --key-id &lt;KeyId&gt; --policy-name default</code>Â (if allowed) saves the JSON.Â <em>Useful for later restoration or careful edits.</em></li>
<li><strong>Craft permissive policy</strong>Â â€“ createÂ <code>evil.json</code>Â that adds your principal withÂ <code>&quot;Action&quot;:&quot;kms:*&quot;</code>Â on the key, or setsÂ <code>&quot;Principal&quot;:&quot;*&quot;</code>Â for total takeover.Â <em>Defines your escalated rights.</em></li>
<li><strong>Upload new policy</strong>Â â€“Â <code>aws kms put-key-policy --key-id &lt;KeyId&gt; --policy-name default --policy file://evil.json</code>Â overwrites the existing document.Â <em>You are now a key admin.</em></li>
<li><strong>Exploit access</strong>Â â€“ decrypt Secrets Manager ciphertexts, reâ€‘encrypt data with keys only you control, or create grants for other attacker principals.Â <em>Breaks dataâ€‘atâ€‘rest guarantees across S3, RDS, EBS, etc.</em></li>
</ol>
<p><a target="_blank" rel="noopener" href="https://cloud.hacktricks.wiki/en/pentesting-cloud/aws-security/aws-privilege-escalation/aws-kms-privesc.html">HackTricks Reference</a></p>
<hr>
<h2 id="Other-High-Frequency-Cloud-Weaknesses"><a href="#Other-High-Frequency-Cloud-Weaknesses" class="headerlink" title="Other High-Frequency Cloud Weaknesses"></a><strong>Other High-Frequency Cloud Weaknesses</strong></h2><h3 id="1-Leaked-keys-secrets"><a href="#1-Leaked-keys-secrets" class="headerlink" title="1. Leaked keys &amp; secrets"></a><strong>1. Leaked keys &amp; secrets</strong></h3><p>GitGuardianâ€™s 2024Â <em>State of Secrets Sprawl</em>Â detectedÂ <strong>12.7â€¯million</strong>Â new secrets in public GitHub commitsâ€”many of them AWS keys (<a target="_blank" rel="noopener" href="https://www.gitguardian.com/state-of-secrets-sprawl-report-2024?utm_source=chatgpt.com">gitguardian.com</a>). Independent researchers found attackers start abusing freshly leaked keys within minutes (<a target="_blank" rel="noopener" href="https://www.helpnetsecurity.com/2024/12/02/revoke-exposed-aws-keys/?utm_source=chatgpt.com">helpnetsecurity.com</a>). Realâ€‘world examples include Uberâ€™s 2022 breach triggered by a hardâ€‘coded admin credential in a PowerShell script (<a target="_blank" rel="noopener" href="https://medium.com/%40tolubanji/hardcoded-secrets-the-unseen-security-risk-lurking-in-your-code-102396345115?utm_source=chatgpt.com">medium.com</a>) and Toyota accidentally publishing longâ€‘lived access tokens to GitHub for five years (<a target="_blank" rel="noopener" href="https://blog.gitguardian.com/toyota-accidently-exposed-a-secret-key-publicly-on-github-for-five-years/?utm_source=chatgpt.com">blog.gitguardian.com</a>).</p>
<p><strong>Mitigation:</strong>Â enable secret scanning in CI, rotate keys frequently, prefer roles over longâ€‘lived keys, and block public CI artifacts that containÂ <code>.aws/</code>Â credential files.</p>
<h3 id="2-Public-storage-network-exposure"><a href="#2-Public-storage-network-exposure" class="headerlink" title="2. Public storage &amp; network exposure"></a><strong>2. Public storage &amp; network exposure</strong></h3><p>Public data stores (S3 buckets, EBS snapshots, RDS instances) and overly permissive network paths (security groups allowingÂ <code>0.0.0.0/0</code>, NodePorts, or public load balancers) share the same root problem:Â <strong>resources are reachable from the internet when they shouldnâ€™t be</strong>. Capital Oneâ€™s breach blended an overâ€‘permissive WAF role with a public S3 bucket (<a target="_blank" rel="noopener" href="https://www.darkreading.com/cyberattacks-data-breaches/capital-one-attacker-exploited-misconfigured-aws-databases?utm_source=chatgpt.com">darkreading.com</a>); Pegasus Airlines exposed 6.5â€¯TB of flight data in an S3 bucket (<a target="_blank" rel="noopener" href="https://www.cshub.com/attacks/news/iotw-turkish-based-airline-leaves-65-tb-of-sensitive-data-exposed?utm_source=chatgpt.com">cshub.com</a>); and Accenture left four S3 buckets worldâ€‘readable, leaking internal credentials (<a target="_blank" rel="noopener" href="https://www.upguard.com/breaches/cloud-leak-accenture?utm_source=chatgpt.com">upguard.com</a>).</p>
<p><strong>Mitigation:</strong>Â enforce private subnets and VPC endpoints for storage services, apply securityâ€‘group baselines that denyÂ <code>0.0.0.0/0</code>Â except via a bastion or WAFâ€‘protected load balancer, and run continuous exposure scans with tools like ScoutSuite, Prowler, or CloudMapper.</p>
<h3 id="3-Misconfigured-crossâ€‘account-trust"><a href="#3-Misconfigured-crossâ€‘account-trust" class="headerlink" title="3. Misconfigured crossâ€‘account trust"></a><strong>3. Misconfigured crossâ€‘account trust</strong></h3><p>Trust paths that allow external AWS accountsâ€”or worse, the entire internet viaÂ <code>&quot;Principal&quot;:&quot;*&quot;</code>â€”become silent back doors. Twilioâ€™s 2022 incident began with SMSâ€‘phishing of employee credentials, then leveraged trusted roles to pivot to customer data (<a target="_blank" rel="noopener" href="https://www.wired.com/story/twilio-breach-phishing-supply-chain-attacks?utm_source=chatgpt.com">wired.com</a>). Forgotten vendor roles or old CI&#x2F;CD integrations have caused similar lateral movement in redâ€‘team exercises.</p>
<p><strong>Mitigation:</strong>Â enable IAMÂ <strong>Access Analyzer</strong>Â to detect unintended public or crossâ€‘account access, review trust policies quarterly, and require external IDs plus condition keys such asÂ <code>aws:PrincipalOrgID</code>Â when sharing roles with suppliers. Public storage &amp; network exposure</p>
<p>Public data stores (S3 buckets, EBS snapshots, RDS instances) and overly permissive network paths (security groups allowingÂ <code>0.0.0.0/0</code>, NodePorts, or public load balancers) share the same root problem:Â <strong>resources are reachable from the internet when they shouldnâ€™t be</strong>. Capital Oneâ€™s 2019 breach mixed an overâ€‘permissive IAM role with an S3 bucket policy, while hundreds of companies have leaked customer databases by exposing MongoDB, Redis, or Elasticsearch on public IPs.</p>
<p><strong>Mitigation:</strong>Â enforce private subnets and VPC endpoints for storage services, apply securityâ€‘group baselines that denyÂ <code>0.0.0.0/0</code>Â except via a bastion or WAFâ€‘protected load balancer, and run continuous exposure scans with tools like ScoutSuite, Prowler, or CloudMapper.</p>
<h3 id="3-Misconfigured-crossâ€‘account-trust-1"><a href="#3-Misconfigured-crossâ€‘account-trust-1" class="headerlink" title="3. Misconfigured crossâ€‘account trust"></a><strong>3. Misconfigured crossâ€‘account trust</strong></h3><p>Trust relationships that allow external AWS accountsâ€”or worse, the entire internet viaÂ <code>&quot;Principal&quot;:&quot;*&quot;</code>Â in an IAM trust policyâ€”can hand attackers a permanent back door even if your own IAM permissions look tight. Redâ€‘team assessments often uncover forgotten vendor roles or legacy OAuth integrations that now let a compromised partner pivot into your environment.</p>
<p><strong>Mitigation:</strong>Â enable IAMÂ <strong>Access Analyzer</strong>Â to detect unintended public or crossâ€‘account access, review trust policies quarterly, and require external IDs plus condition keys such asÂ <code>aws:PrincipalOrgID</code>Â when sharing roles with suppliers.</p>
<h2 id="What-about-persistence"><a href="#What-about-persistence" class="headerlink" title="What about persistence?"></a><strong>What about persistence?</strong></h2><p>When an attacker gains access, the next objective is toÂ <strong>remain in your environment without tripping alarms</strong>. In AWS, persistence can be established through identities (IAM), infrastructure (EC2 userâ€‘data, container images), or serverless hooks (EventBridge, Lambda). Common, noisy tricks include:</p>
<ul>
<li><strong>Creating a new IAM userâ€¯+â€¯access keys</strong>Â hidden among legitimate accounts.</li>
<li><strong>Adding their own SSH key</strong>Â to EC2 instance metadata or User Data.</li>
<li><strong>Scheduling a Lambda or Step Functions task</strong>Â to reâ€‘deploy backdoors daily.</li>
<li><strong>Planting malicious versioned objects</strong>Â in S3 or CodeCommit that CI&#x2F;CD pipelines autoâ€‘pull.</li>
</ul>
<p>However, those actions are usually very noisy. Below we explore a stealthier method that abuses Lambda layersâ€”a resource most teams overlook during audits.</p>
<h3 id="Stealthy-Persistence-Lambda-Layer-Backdoor"><a href="#Stealthy-Persistence-Lambda-Layer-Backdoor" class="headerlink" title="Stealthy Persistence: Lambda Layer Backdoor"></a><strong>Stealthy Persistence: Lambda Layer Backdoor</strong></h3><p>AWS LambdaÂ <strong>layers</strong>Â let youÂ <strong>inject shared code</strong>Â into one or many functions. If an attacker controlsÂ <code>lambda:PublishLayerVersion</code>Â andÂ <code>lambda:UpdateFunctionConfiguration</code>, they achieveÂ <strong>preâ€‘execution code injection</strong>: every cold start loads their moduleÂ <em>before</em>Â the legitimate handler, enabling secret scraping, SDK monkeyâ€‘patching, or reverse shellsâ€”allÂ <strong>without altering the function code visible in the console</strong>. Layers are accountâ€‘global, regionâ€‘scoped, and referenced only by ARN plus version, so malicious variants hide in plain sight and survive CI redeploys.</p>
<h3 id="Attack-recipe"><a href="#Attack-recipe" class="headerlink" title="Attack recipe"></a><strong>Attack recipe</strong></h3><ol>
<li>Craft a layer containing malicious Python (<code>sitecustomize.py</code>) or Node.js (<code>index.js</code>) that executes on import.</li>
<li>Upload withÂ <code>lambda:PublishLayerVersion</code>Â (createsÂ <code>arn:aws:lambda:region:acct-id:layer:evil:1</code>).</li>
<li>Attach the layer to a target function viaÂ <code>lambda:UpdateFunctionConfiguration</code>. This doesÂ <strong>not</strong>Â modify the function code itselfâ€”auditors reviewing the inline handler will see nothing.</li>
<li>Each invocation of the function automatically imports the malicious layer, exfiltrating secrets or opening a reverse shell.</li>
<li>The attacker can later push a new version (<code>lambda:PublishLayerVersion</code>Â again) and silently bump the function to the new ARN, persisting across blueâ€‘green deployments.</li>
</ol>
<h3 id="Why-it-evades-detection"><a href="#Why-it-evades-detection" class="headerlink" title="Why it evades detection"></a><strong>Why it evades detection</strong></h3><ul>
<li>CloudTrail logs showÂ <code>UpdateFunctionConfiguration</code>Â but security teams rarely inspect theÂ <code>Layers</code>Â field.</li>
<li>The layer code executes inâ€‘process, so there are no unusual outbound API calls unless the payload triggers them.</li>
<li>Layers can be shared; a single rogue layer can infect dozens of functions across multiple teams.</li>
</ul>
<hr>
<h2 id="Defense-Monitoring-Strategies"><a href="#Defense-Monitoring-Strategies" class="headerlink" title="Defense &amp; Monitoring Strategies"></a><strong>Defense &amp; Monitoring Strategies</strong></h2><p>Securing AWS is not a oneâ€‘time checklistâ€”it is continuousÂ <strong>hardening + monitoring</strong>Â on every account.</p>
<h3 id="1-Harden-every-account-in-isolation"><a href="#1-Harden-every-account-in-isolation" class="headerlink" title="1. Harden every account in isolation"></a><strong>1. Harden every account in isolation</strong></h3><ul>
<li><strong>Least privilege IAM</strong>Â â€“ prune unused permissions, rely on roles not users, and enforce MFA.</li>
<li><strong>Service Control Policies (SCPs)</strong>Â â€“ create denyâ€‘all guardrails (e.g., blockÂ <code>s3:PutBucketPolicy</code>Â that makes buckets public).</li>
<li><strong>Secure defaults</strong>Â â€“ force EBS encryption by default, disable public AMIs, require IMDSv2 on EC2.</li>
</ul>
<h3 id="2-Eliminate-misconfigurations-early"><a href="#2-Eliminate-misconfigurations-early" class="headerlink" title="2. Eliminate misconfigurations early"></a><strong>2. Eliminate misconfigurations early</strong></h3><ul>
<li><strong>IaC scanning</strong>Â â€“ integrate tfsec, cfnâ€‘nag, or Checkov in CI to fail builds containing risky patterns.</li>
<li><strong>AWS Config rules</strong>Â â€“ require S3 versioning, RDS encryption, no open Security Groups, etc.</li>
<li><strong>Stack sets &amp; baselines</strong>Â â€“ deploy golden VPCs, guard S3 buckets with Block Public Access, and set mandatory tags.</li>
</ul>
<h3 id="3-Restrict-external-trust"><a href="#3-Restrict-external-trust" class="headerlink" title="3. Restrict external trust"></a><strong>3. Restrict external trust</strong></h3><ul>
<li><strong>Donâ€™t grant wildcards</strong>Â â€“ avoidÂ <code>&quot;Principal&quot;:&quot;*&quot;</code>Â in trust policies.</li>
<li>Use ExternalId +Â <strong><code>aws:PrincipalOrgID</code></strong>Â when letting vendors assume roles.</li>
<li><strong>Rotate credentials</strong>Â or disable trust paths when contracts end.</li>
</ul>
<h3 id="4-Test-the-posture-constantly"><a href="#4-Test-the-posture-constantly" class="headerlink" title="4. Test the posture constantly"></a><strong>4. Test the posture constantly</strong></h3><ul>
<li><strong>Automated scanners</strong>Â â€“ run Prowler, ScoutSuite, or AWS Trusted Advisor weekly.</li>
<li><strong>Periodic pentests &amp; red teaming</strong>Â â€“ simulate adversaries, validate alerting, and measure timeâ€‘toâ€‘detection.</li>
<li><strong>Chaos engineering</strong>Â â€“ sandbox killâ€‘switches (e.g., revokeÂ <code>AdministratorAccess</code>Â in dev) to prove leastâ€‘privilege.</li>
</ul>
<h3 id="5-Monitor-for-malicious-actions"><a href="#5-Monitor-for-malicious-actions" class="headerlink" title="5. Monitor for malicious actions"></a><strong>5. Monitor for malicious actions</strong></h3><ul>
<li><strong>Organizationâ€‘wide CloudTrail</strong>Â to a dedicated logging account with S3 Bucket Logging and MFA delete.</li>
<li><strong>GuardDuty</strong>Â for anomaly + threat intel detection (cryptoâ€‘miners, backdoor IPs, credential exfil).</li>
<li><strong>Security Hub</strong>Â to aggregate findings; autoâ€‘remediate with EventBridge + Lambda (e.g., disable keys leaked to GitHub).</li>
<li><strong>CloudWatch &amp; EventBridge rules</strong>Â â€“ alert on risky APIs:Â <code>iam:CreateAccessKey</code>,Â <code>kms:PutKeyPolicy</code>,Â <code>lambda:PublishLayerVersion</code>.</li>
<li><strong>Centralized SIEM</strong>Â to correlate AWS logs with endpoint and SaaS telemetry.</li>
</ul>
<h1 id="Wrap-Up"><a href="#Wrap-Up" class="headerlink" title="Wrap-Up"></a><strong>Wrap-Up</strong></h1><h2 id="Key-Takeaways"><a href="#Key-Takeaways" class="headerlink" title="Key Takeaways"></a>Key Takeaways</h2><ol>
<li>Follow the least privilege principle from day one.</li>
<li>Why you should split dev, test, and prod into different accounts.</li>
<li>Lock down the root &#x2F; management account with MFA â€” and never use it!</li>
<li>Continuously harden all AWS accounts and have alerts to detect malicious actions.</li>
<li>Inspect lessâ€‘obvious spots like Lambda layers and snapshots.</li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://malw0re.github.io/ouhboy">malw0re</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://malw0re.github.io/ouhboy/2026/01/11/Aws/">https://malw0re.github.io/ouhboy/2026/01/11/Aws/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/ouhboy/tags/AWS/">AWS</a><a class="post-meta__tags" href="/ouhboy/tags/CloudSecurity/">CloudSecurity</a><a class="post-meta__tags" href="/ouhboy/tags/Cloud/">Cloud</a></div><div class="post-share"><div class="social-share" data-image="/ouhboy/images/aws.png" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/ouhboy/2024/07/13/kerberos-101/" title="Kerberos"><img class="cover" src="/ouhboy/images/kerb.webp" onerror="onerror=null;src='/ouhboy/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Kerberos</div></div><div class="info-2"><div class="info-item-1">KerberoastingThe Kerberos protocol defines how clients interact with a network authentication service, clients obtain tickets from the Kerberos Key Distribution Center (KDC) and they submit these tickets to application servers when connections are established. uses port 88 by default and depends on the process of symmetric key cryptography. NB [kerberos uses tickets to authenticate a user and completely avoids sending passwords across the network]  How Kerb Auth works!In every Active Director...</div></div></div></a><a class="pagination-related" href="/ouhboy/2026/01/18/Azure/" title="Azure Security"><img class="cover" src="/ouhboy/images/azure.jpeg" onerror="onerror=null;src='/ouhboy/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">Azure Security</div></div><div class="info-2"><div class="info-item-1">Before we do anything else, letâ€™s start at the absolute beginning with Identity. EntraID Identity BasicsğŸªª Tenant â€“ Your Identity and Trust Boundary in Entra IDIn Microsoft Entra ID, a tenant is the dedicated, isolated instance of Microsoftâ€™s identity and access management service for your organization. It represents your organizationâ€™s trust boundary, containing your users, groups, applications, and service principals, along with all associated identity and security configurations. Each tena...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/ouhboy/2026/01/18/Azure/" title="Azure Security"><img class="cover" src="/ouhboy/images/azure.jpeg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-01-18</div><div class="info-item-2">Azure Security</div></div><div class="info-2"><div class="info-item-1">Before we do anything else, letâ€™s start at the absolute beginning with Identity. EntraID Identity BasicsğŸªª Tenant â€“ Your Identity and Trust Boundary in Entra IDIn Microsoft Entra ID, a tenant is the dedicated, isolated instance of Microsoftâ€™s identity and access management service for your organization. It represents your organizationâ€™s trust boundary, containing your users, groups, applications, and service principals, along with all associated identity and security configurations. Each tena...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/ouhboy/images/cyber.png" onerror="this.onerror=null;this.src='/ouhboy/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">malw0re</div><div class="author-info-description">Cybersecurity, CTFs</div><div class="site-data"><a href="/ouhboy/archives/"><div class="headline">Articles</div><div class="length-num">10</div></a><a href="/ouhboy/tags/"><div class="headline">Tags</div><div class="length-num">14</div></a><a href="/ouhboy/categories/"><div class="headline">Categories</div><div class="length-num">3</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/malw0re"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/MALW0RE" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="https://www.linkedin.com/in/karanja-brian/" target="_blank" title="LinkedIn"><i class="fab fa-linkedin" style="color: #4a7dbe;"></i></a><a class="social-icon" href="https://www.x.com/M4LW0R3" target="_blank" title="Instagram"><i class="fab fa-twitter" style="color: #cd486b;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my blog where I post my writeups from Boxes & CTFs along with exploit research!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#AWS-Security"><span class="toc-number">1.</span> <span class="toc-text">AWS Security</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#AWS-Identity-Basics"><span class="toc-number">1.1.</span> <span class="toc-text">AWS Identity Basics</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Account-%E2%80%93-Your-Primary-Security-Boundary"><span class="toc-number">1.1.1.</span> <span class="toc-text">Account â€“ Your Primary Security Boundary</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Organization-%E2%80%93-Governance-at-Scale"><span class="toc-number">1.1.2.</span> <span class="toc-text">Organization â€“ Governance at Scale</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#User-%E2%80%93-Long%E2%80%91Lived-Human-Credential"><span class="toc-number">1.1.3.</span> <span class="toc-text">User â€“ Longâ€‘Lived Human Credential</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Role-%E2%80%93-Temporary-Scoped-Identity"><span class="toc-number">1.1.4.</span> <span class="toc-text">Role â€“ Temporary, Scoped Identity</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Policy-%E2%80%93-Permissions-DNA"><span class="toc-number">1.1.5.</span> <span class="toc-text">Policy â€“ Permissions DNA</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Over%E2%80%91Privilege-Cloud-Enemy-1"><span class="toc-number">1.2.</span> <span class="toc-text">Overâ€‘Privilege: Cloud Enemy #1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Three-Practical-Privilege-Escalation-Paths"><span class="toc-number">1.3.</span> <span class="toc-text">Three Practical Privilege Escalation Paths</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-AttachUserPolicy"><span class="toc-number">1.3.1.</span> <span class="toc-text">1. AttachUserPolicy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-PassRole-RunInstances"><span class="toc-number">1.3.2.</span> <span class="toc-text">2. PassRole + RunInstances</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-PutKeyPolicy-Overreach-KMS"><span class="toc-number">1.3.3.</span> <span class="toc-text">3. PutKeyPolicy Overreach (KMS)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Other-High-Frequency-Cloud-Weaknesses"><span class="toc-number">1.4.</span> <span class="toc-text">Other High-Frequency Cloud Weaknesses</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Leaked-keys-secrets"><span class="toc-number">1.4.1.</span> <span class="toc-text">1. Leaked keys &amp; secrets</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Public-storage-network-exposure"><span class="toc-number">1.4.2.</span> <span class="toc-text">2. Public storage &amp; network exposure</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Misconfigured-cross%E2%80%91account-trust"><span class="toc-number">1.4.3.</span> <span class="toc-text">3. Misconfigured crossâ€‘account trust</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Misconfigured-cross%E2%80%91account-trust-1"><span class="toc-number">1.4.4.</span> <span class="toc-text">3. Misconfigured crossâ€‘account trust</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#What-about-persistence"><span class="toc-number">1.5.</span> <span class="toc-text">What about persistence?</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Stealthy-Persistence-Lambda-Layer-Backdoor"><span class="toc-number">1.5.1.</span> <span class="toc-text">Stealthy Persistence: Lambda Layer Backdoor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Attack-recipe"><span class="toc-number">1.5.2.</span> <span class="toc-text">Attack recipe</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Why-it-evades-detection"><span class="toc-number">1.5.3.</span> <span class="toc-text">Why it evades detection</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Defense-Monitoring-Strategies"><span class="toc-number">1.6.</span> <span class="toc-text">Defense &amp; Monitoring Strategies</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Harden-every-account-in-isolation"><span class="toc-number">1.6.1.</span> <span class="toc-text">1. Harden every account in isolation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Eliminate-misconfigurations-early"><span class="toc-number">1.6.2.</span> <span class="toc-text">2. Eliminate misconfigurations early</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Restrict-external-trust"><span class="toc-number">1.6.3.</span> <span class="toc-text">3. Restrict external trust</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-Test-the-posture-constantly"><span class="toc-number">1.6.4.</span> <span class="toc-text">4. Test the posture constantly</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-Monitor-for-malicious-actions"><span class="toc-number">1.6.5.</span> <span class="toc-text">5. Monitor for malicious actions</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Wrap-Up"><span class="toc-number">2.</span> <span class="toc-text">Wrap-Up</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Key-Takeaways"><span class="toc-number">2.1.</span> <span class="toc-text">Key Takeaways</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/ouhboy/2026/02/01/Facts/" title="Untitled">Untitled</a><time datetime="2026-02-01T00:16:37.097Z" title="Created 2026-02-01 03:16:37">2026-02-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/ouhboy/2026/02/01/facter/" title="Facts HTB Writeup"><img src="/ouhboy/images/facts.jpg" onerror="this.onerror=null;this.src='/ouhboy/img/404.jpg'" alt="Facts HTB Writeup"/></a><div class="content"><a class="title" href="/ouhboy/2026/02/01/facter/" title="Facts HTB Writeup">Facts HTB Writeup</a><time datetime="2026-01-31T23:38:46.000Z" title="Created 2026-02-01 02:38:46">2026-02-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/ouhboy/2026/01/18/Azure/" title="Azure Security"><img src="/ouhboy/images/azure.jpeg" onerror="this.onerror=null;this.src='/ouhboy/img/404.jpg'" alt="Azure Security"/></a><div class="content"><a class="title" href="/ouhboy/2026/01/18/Azure/" title="Azure Security">Azure Security</a><time datetime="2026-01-18T09:44:04.000Z" title="Created 2026-01-18 12:44:04">2026-01-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/ouhboy/2026/01/11/Aws/" title="AWS Security"><img src="/ouhboy/images/aws.png" onerror="this.onerror=null;this.src='/ouhboy/img/404.jpg'" alt="AWS Security"/></a><div class="content"><a class="title" href="/ouhboy/2026/01/11/Aws/" title="AWS Security">AWS Security</a><time datetime="2026-01-11T09:44:04.000Z" title="Created 2026-01-11 12:44:04">2026-01-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/ouhboy/2024/07/13/kerberos-101/" title="Kerberos"><img src="/ouhboy/images/kerb.webp" onerror="this.onerror=null;this.src='/ouhboy/img/404.jpg'" alt="Kerberos"/></a><div class="content"><a class="title" href="/ouhboy/2024/07/13/kerberos-101/" title="Kerberos">Kerberos</a><time datetime="2024-07-12T21:00:00.000Z" title="Created 2024-07-13 00:00:00">2024-07-13</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;Since 100 BC - 2026 By malw0re</span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/ouhboy/js/utils.js?v=5.5.3"></script><script src="/ouhboy/js/main.js?v=5.5.3"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><div class="js-pjax"></div><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/click-show-text.min.js" data-mobile="false" data-text="getsystem,sudo rm -rf,root,administrator,havoc,sliver,cobalt strike,python,c#,daz,empire,( Í¡Â° ÍœÊ– Í¡Â°)" data-fontsize="15px" data-random="true" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>